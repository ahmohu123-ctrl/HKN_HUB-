<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جرين جولد العز - نظام شامل</title>
    <!-- تضمين Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- تضمين خط مناسب -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Noto+Sans+Arabic:wght{100..900}&display=swap" rel="stylesheet">
    <style>
        /* الخط الأساسي والتأثيرات العامة للسلاسة */
        body {
            font-family: 'Noto Sans Arabic', 'Inter', sans-serif;
            background-color: #1a202c; /* خلفية داكنة جداً */
        }
        /* تطبيق الانتقال السلس على كل شيء تقريباً */
        .smooth-transition {
            transition: all 0.3s ease-in-out;
        }
        /* لتطبيق الحركة السلسة على قائمة الجوال */
        #mobile-menu {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.4s cubic-bezier(0.4, 0, 0.2, 1); /* حركة أنيقة */
        }
        #mobile-menu.open {
            max-height: 500px; 
        }
        /* لتطبيق الحركة السلسة على إظهار الصفحات */
        .view {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.4s cubic-bezier(0.4, 0, 0.2, 1), transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .view.hidden {
            opacity: 0;
            transform: translateY(15px);
            pointer-events: none;
            height: 0;
        }
        /* تصميم زر السلة البارز */
        #cart-button-container {
            position: relative;
        }
        #cart-count {
            position: absolute;
            top: -5px;
            left: -5px;
            padding: 2px 7px;
            border-radius: 9999px;
            font-size: 0.75rem;
            line-height: 1;
        }
    </style>
</head>
<body class="bg-gray-900 text-white antialiased min-h-screen flex flex-col">

    <!-- شريط التنقل (Header) -->
    <header class="bg-green-700 shadow-2xl sticky top-0 z-50">
        <div class="container mx-auto p-4 flex justify-between items-center">
            <!-- الشعار -->
            <a href="#" onclick="showView('home'); return false;" class="text-2xl font-black text-yellow-300 smooth-transition">
                جرين جولد
            </a>
            
            <div class="flex items-center space-x-4 space-x-reverse">
                
                <!-- زر السلة (Cart Button) -->
                <button onclick="showModal('cart-modal')" id="cart-button-container" class="p-2 rounded-full text-white bg-green-600 hover:bg-green-500 smooth-transition shadow-lg transform hover:scale-110">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path></svg>
                    <span id="cart-count" class="bg-red-600 text-white font-extrabold hidden smooth-transition">0</span>
                </button>

                <!-- زر قائمة الجوال - تمت إضافة حركة سلسة (smooth) -->
                <button id="mobile-menu-button" class="lg:hidden p-2 rounded-lg text-white hover:bg-green-600 smooth-transition">
                    <svg id="menu-icon-open" class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
                    <svg id="menu-icon-close" class="w-6 h-6 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- روابط التنقل لسطح المكتب -->
            <nav class="hidden lg:flex space-x-6 space-x-reverse text-lg font-medium" id="desktop-nav">
                <a href="#" onclick="showView('home'); return false;" class="text-white hover:text-yellow-300 smooth-transition">الرئيسية</a>
                <a href="#" onclick="showView('about'); return false;" class="text-white hover:text-yellow-300 smooth-transition">عنّا</a>
                <a href="#" onclick="showView('products'); return false;" class="text-white hover:text-yellow-300 smooth-transition">المنتجات للشراء</a>
                <a href="#" onclick="showView('login'); return false;" id="login-nav-link" class="text-white bg-green-800 p-2 rounded-lg hover:bg-green-600 smooth-transition">تسجيل دخول المدير</a>
                <a href="#" onclick="signOutUser(); return false;" id="logout-nav-link" class="text-white bg-red-600 p-2 rounded-lg hover:bg-red-700 smooth-transition hidden">تسجيل الخروج</a>
            </nav>
        </div>
        
        <!-- قائمة الجوال المنبثقة (Mobile Menu) -->
        <nav id="mobile-menu" class="lg:hidden bg-green-800 border-t border-green-900">
            <a href="#" onclick="showView('home'); toggleMobileMenu(); return false;" class="block p-3 text-white hover:bg-green-700 border-b border-green-900 smooth-transition">الرئيسية</a>
            <a href="#" onclick="showView('about'); toggleMobileMenu(); return false;" class="block p-3 text-white hover:bg-green-700 border-b border-green-900 smooth-transition">عنّا</a>
            <a href="#" onclick="showView('products'); toggleMobileMenu(); return false;" class="block p-3 text-white hover:bg-green-700 border-b border-green-900 smooth-transition">المنتجات للشراء</a>
            <a href="#" onclick="showView('login'); toggleMobileMenu(); return false;" id="login-mobile-link" class="block p-3 text-white bg-green-600 hover:bg-green-500 border-b border-green-900 smooth-transition">تسجيل دخول المدير</a>
            <a href="#" onclick="signOutUser(); toggleMobileMenu(); return false;" id="logout-mobile-link" class="block p-3 text-white bg-red-600 hover:bg-red-500 hidden smooth-transition">تسجيل الخروج</a>
        </nav>
    </header>

    <main class="container mx-auto p-4 md:p-8 flex-grow">

        <!-- رسالة النظام (Alerts/Messages) -->
        <div id="system-message" class="hidden fixed top-20 right-4 bg-red-500 text-white p-3 rounded-lg shadow-xl z-50 smooth-transition max-w-xs" role="alert"></div>
        
        <!-- 1. قسم الرئيسية (Home View) - الافتراضي -->
        <section id="home-view" class="view">
            <div class="text-center py-16 md:py-24 bg-gray-800 rounded-2xl shadow-2xl mb-12 border-b-8 border-yellow-400 smooth-transition transform hover:scale-[1.005]">
                <h1 class="text-4xl md:text-6xl font-black text-white mb-4 leading-tight">
                    رؤيتنا: <span class="text-green-400">الريادة في الذهب الأخضر</span>
                </h1>
                <p class="text-xl md:text-2xl text-gray-300 max-w-3xl mx-auto mb-10">
                    حلول زراعية متكاملة ومستدامة لتعزيز إنتاجية أراضيكم بأعلى جودة عالمية.
                </p>
                <a href="#" onclick="showView('products'); return false;" class="inline-block bg-yellow-400 text-gray-900 font-bold py-3 px-10 rounded-full shadow-lg hover:bg-yellow-500 smooth-transition transform hover:scale-105 text-lg">
                    استعراض المنتجات
                </a>
            </div>
        </section>

        <!-- 2. قسم عنّا (About View) -->
        <section id="about-view" class="view hidden py-12">
            <h1 class="text-4xl font-black text-center mb-12 text-yellow-400 smooth-transition">عنّا</h1>
            
            <div class="space-y-12 max-w-4xl mx-auto">
                
                <!-- قصتنا (Our Story) -->
                <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl border-t-4 border-green-500 smooth-transition transform hover:translate-y-[-5px]">
                    <h2 class="text-3xl font-bold text-green-400 mb-4">قصتنا: من البذرة إلى الازدهار</h2>
                    <p class="text-lg text-gray-300 leading-relaxed">
                        بدأت "جرين جولد العز" كفكرة بسيطة: كيف يمكننا أن نجعل الزراعة أكثر كفاءة واستدامة في منطقتنا؟ على مدى سنوات، تطورت الفكرة إلى شركة رائدة تقدم حلولاً متكاملة، بدءًا من الأسمدة الدقيقة ووصولاً إلى أنظمة الري الذكية. نحن مدفوعون بشغفنا بالبيئة والتزامنا تجاه عملائنا لضمان أن كل محصول يحصد النجاح.
                    </p>
                </div>
                
                <!-- لماذا تخترنا؟ (Why Choose Us?) -->
                <div class="bg-gray-800 p-8 rounded-2xl shadow-2xl border-t-4 border-yellow-500 smooth-transition transform hover:translate-y-[-5px]">
                    <h2 class="text-3xl font-bold text-yellow-400 mb-4">لماذا تختار جرين جولد العز؟</h2>
                    <ul class="space-y-3 text-lg text-gray-300 list-none pr-0">
                        <li class="flex items-start">
                            <span class="text-green-400 ml-2 mt-1 font-extrabold text-2xl">✔</span>
                            <p><strong>الجودة المُختبرة:</strong> نضمن أن جميع منتجاتنا وخدماتنا مطابقة لأعلى المعايير العالمية لزيادة إنتاجيتك.</p>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-400 ml-2 mt-1 font-extrabold text-2xl">✔</span>
                            <p><strong>الخبرة المحلية:</strong> فريقنا يفهم تحديات التربة والمناخ في المنطقة ويقدم حلولاً مصممة خصيصاً لك.</p>
                        </li>
                        <li class="flex items-start">
                            <span class="text-green-400 ml-2 mt-1 font-extrabold text-2xl">✔</span>
                            <p><strong>الاستدامة أولاً:</strong> نركز على الحلول الصديقة للبيئة والموفرة للمياه لضمان مستقبل أخضر.</p>
                        </li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- 3. صفحة المنتجات للشراء (Products View) -->
        <section id="products-view" class="view hidden">
            <h1 class="text-4xl font-black text-center mb-12 text-green-400 smooth-transition">منتجاتنا المتاحة للشراء</h1>
            <div id="products-list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- المنتجات سيتم إضافتها هنا عبر JavaScript -->
            </div>
            <p id="no-products-message" class="text-center text-gray-500 mt-10 hidden">لا توجد منتجات متاحة حاليًا.</p>
        </section>

        <!-- 4. صفحة تسجيل الدخول (Login View) -->
        <section id="login-view" class="view hidden">
            <h1 class="text-4xl font-black text-center mb-12 text-yellow-400 smooth-transition">تسجيل دخول المدير</h1>
            <div class="max-w-md mx-auto bg-gray-800 p-8 rounded-2xl shadow-2xl border border-gray-700 smooth-transition">
                <form id="login-form" class="space-y-6">
                    <div>
                        <label for="admin-email" class="block text-sm font-medium text-gray-300 mb-1">البريد الإلكتروني</label>
                        <input type="email" id="admin-email" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-green-500 focus:border-green-500 smooth-transition" required>
                    </div>
                    <div>
                        <label for="admin-password" class="block text-sm font-medium text-gray-300 mb-1">كلمة المرور</label>
                        <input type="password" id="admin-password" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:ring-green-500 focus:border-green-500 smooth-transition" required>
                    </div>
                    <button type="submit" class="w-full bg-yellow-500 text-gray-900 font-bold py-3 rounded-lg hover:bg-yellow-600 smooth-transition shadow-md">
                        تسجيل الدخول
                    </button>
                </form>
            </div>
        </section>

        <!-- 5. صفحة المدير (Admin View) -->
        <section id="admin-view" class="view hidden">
            <h1 class="text-4xl font-black text-center mb-12 text-green-400 smooth-transition">لوحة تحكم المدير</h1>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                
                <!-- عمود نشر المنتجات -->
                <div class="lg:col-span-1 bg-gray-800 p-6 rounded-2xl shadow-2xl border-t-4 border-yellow-400 smooth-transition">
                    <h2 class="text-2xl font-bold mb-6 text-green-300">نشر منتج جديد</h2>
                    <form id="product-form" class="space-y-4">
                        <div>
                            <label for="product-name" class="block text-sm font-medium text-gray-300 mb-1">اسم المنتج</label>
                            <input type="text" id="product-name" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition" required>
                        </div>
                        <div>
                            <label for="product-desc" class="block text-sm font-medium text-gray-300 mb-1">وصف المنتج</label>
                            <textarea id="product-desc" rows="3" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition" required></textarea>
                        </div>
                        <div>
                            <label for="product-price" class="block text-sm font-medium text-gray-300 mb-1">السعر (ج.م/ر.س)</label>
                            <input type="number" id="product-price" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition" required min="1">
                        </div>
                        <!-- حقل رفع الصورة الجديد -->
                        <div>
                            <label for="product-image-file" class="block text-sm font-medium text-gray-300 mb-1">صورة المنتج (من الجهاز)</label>
                            <input type="file" id="product-image-file" accept="image/*" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition">
                            <p class="text-xs text-gray-400 mt-1">يجب أن يكون الملف أقل من 1 ميجابايت.</p>
                        </div>
                        <button type="submit" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 smooth-transition shadow-md">
                            نشر المنتج
                        </button>
                    </form>
                </div>

                <!-- عمود المنتجات المنشورة + الطلبات -->
                <div class="lg:col-span-2 space-y-8">
                    <!-- قائمة الطلبات الجديدة -->
                    <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl border-t-4 border-red-500 smooth-transition">
                        <h2 class="text-2xl font-bold mb-6 text-red-400">الطلبات الجديدة</h2>
                        <div id="orders-list" class="space-y-4">
                            <!-- الطلبات ستُعرض هنا -->
                            <p class="text-gray-500" id="no-orders-message">لا توجد طلبات شراء جديدة.</p>
                        </div>
                    </div>

                    <!-- المنتجات المنشورة -->
                    <div class="bg-gray-800 p-6 rounded-2xl shadow-2xl border-t-4 border-blue-400 smooth-transition">
                        <h2 class="text-2xl font-bold mb-6 text-blue-300">المنتجات المنشورة</h2>
                        <div id="published-products-list" class="space-y-4">
                            <!-- المنتجات المنشورة ستُعرض هنا -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>
    
    <!-- 6. نافذة سلة التسوق (Cart Modal) -->
    <div id="cart-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-40 smooth-transition">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-lg w-full m-4 border-t-4 border-yellow-400 smooth-transition transform scale-100">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-yellow-400">سلة التسوق</h2>
                <button onclick="hideModal('cart-modal')" class="text-gray-400 hover:text-white smooth-transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <div id="cart-items-list" class="space-y-4 max-h-80 overflow-y-auto pr-2">
                <!-- محتوى السلة سيتم إضافته هنا -->
            </div>
            
            <p id="empty-cart-message" class="text-center text-gray-500 py-6 hidden">السلة فارغة حاليًا.</p>

            <div id="cart-summary" class="border-t border-gray-700 mt-6 pt-4 space-y-3">
                <div class="flex justify-between items-center text-xl font-bold">
                    <span>الإجمالي:</span>
                    <span id="cart-total" class="text-green-400">0 ج.م/ر.س</span>
                </div>
                
                <button onclick="prepareCheckout()" id="checkout-button" class="w-full bg-green-600 text-white font-bold py-3 rounded-lg hover:bg-green-700 smooth-transition shadow-lg disabled:bg-gray-500" disabled>
                    إتمام الشراء
                </button>
            </div>
        </div>
    </div>


    <!-- 7. نموذج الدفع (Checkout Modal) -->
    <div id="checkout-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-40 smooth-transition">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-lg w-full m-4 border-t-4 border-green-400 smooth-transition transform scale-100">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold text-green-400">تأكيد معلومات العميل</h2>
                <button onclick="hideModal('checkout-modal')" class="text-gray-400 hover:text-white smooth-transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <p class="text-lg font-semibold text-gray-300 mb-4">أنت على وشك إرسال طلب لمنتجات بقيمة إجمالية: <span id="checkout-total-display" class="text-yellow-300"></span></p>
            <form id="purchase-form" class="space-y-4">
                
                <div>
                    <label for="customer-name" class="block text-sm font-medium text-gray-300 mb-1">الاسم الكامل</label>
                    <input type="text" id="customer-name" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition" required>
                </div>
                <div>
                    <label for="customer-phone" class="block text-sm font-medium text-gray-300 mb-1">رقم الهاتف للتواصل</label>
                    <input type="tel" id="customer-phone" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition" required>
                </div>
                <div>
                    <label for="customer-address" class="block text-sm font-medium text-gray-300 mb-1">العنوان التفصيلي</label>
                    <textarea id="customer-address" rows="3" class="w-full p-3 bg-gray-700 rounded-lg border-gray-600 text-white smooth-transition" required></textarea>
                </div>
                
                <button type="submit" class="w-full bg-yellow-500 text-gray-900 font-bold py-3 rounded-lg hover:bg-yellow-600 smooth-transition shadow-md">
                    تأكيد وإرسال الطلب
                </button>
            </form>
        </div>
    </div>
    
    <!-- 8. نافذة تأكيد الحذف المخصصة (Custom Confirmation Modal) -->
    <div id="confirmation-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center z-50 smooth-transition">
        <div class="bg-gray-800 p-6 rounded-xl shadow-2xl max-w-sm w-full m-4 border-t-4 border-red-500 smooth-transition transform scale-100">
            <h3 class="text-xl font-bold text-red-400 mb-4">تأكيد الإجراء</h3>
            <p id="confirm-message" class="text-gray-300 mb-6">هل أنت متأكد من حذف هذا العنصر؟ لا يمكن التراجع عن هذا الإجراء.</p>
            <div class="flex justify-end space-x-4 space-x-reverse">
                <button onclick="executePendingAction(false)" class="bg-gray-600 text-white py-2 px-4 rounded-lg hover:bg-gray-700 smooth-transition">
                    إلغاء
                </button>
                <button onclick="executePendingAction(true)" class="bg-red-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-red-700 smooth-transition">
                    حذف
                </button>
            </div>
        </div>
    </div>


    <!-- التذييل (Footer) -->
    <footer class="bg-gray-900 border-t border-green-700 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-gray-400">&copy; 2025 جرين جولد العز. نظام الإدارة.</p>
        </div>
    </footer>

    <!-- JavaScript Logic (Using LocalStorage) -->
    <script>
        
        // --- ADMIN & STORAGE KEYS ---
        const ADMIN_EMAIL = 'manager@greengold.com';
        const ADMIN_PASSWORD = 'admin123';
        const ADMIN_STORAGE_KEY = 'adminLoggedIn';
        const PRODUCTS_STORAGE_KEY = 'greenGoldProducts';
        const ORDERS_STORAGE_KEY = 'greenGoldOrders';
        const CART_STORAGE_KEY = 'greenGoldCart'; // مفتاح جديد للسلة
        
        // --- Core UI Functions ---
        let pendingAction = null; // لتخزين الإجراء المعلق لتأكيده عبر المودال

        function showMessage(text, isError = true) {
            const messageEl = document.getElementById('system-message');
            messageEl.textContent = text;
            messageEl.classList.remove('hidden', 'bg-red-500', 'bg-green-500');
            messageEl.classList.add(isError ? 'bg-red-500' : 'bg-green-500');
            
            setTimeout(() => {
                messageEl.classList.add('hidden');
            }, 5000);
        }

        // إظهار وإخفاء الصفحات مع الحركة السلسة
        function showView(viewId) {
            document.querySelectorAll('.view').forEach(view => {
                view.classList.add('hidden');
                view.classList.add('opacity-0', 'translate-y-[15px]'); // إعداد الحركة للإخفاء
            });

            const targetView = document.getElementById(viewId + '-view');
            if (targetView) {
                setTimeout(() => {
                    targetView.classList.remove('hidden');
                    // لضمان إعادة تشغيل الانتقال عند إظهار الصفحة
                    void targetView.offsetWidth; 
                    targetView.classList.remove('opacity-0', 'translate-y-[15px]');
                }, 10); 
            }
        }

        // إظهار النوافذ المنبثقة
        function showModal(modalId) {
            const modalEl = document.getElementById(modalId);
            modalEl.classList.remove('hidden');
            document.body.style.overflow = 'hidden'; 
            
            // تطبيق الحركة السلسة على محتوى المودال
            const contentEl = modalEl.querySelector('div:first-child');
            if (contentEl) {
                contentEl.classList.add('opacity-0', 'scale-90');
                setTimeout(() => {
                    contentEl.classList.remove('opacity-0', 'scale-90');
                }, 10);
            }
        }

        // إخفاء النوافذ المنبثقة
        function hideModal(modalId) {
            const modalEl = document.getElementById(modalId);
            const contentEl = modalEl.querySelector('div:first-child');
            
            if (contentEl) {
                 contentEl.classList.add('opacity-0', 'scale-90');
                 setTimeout(() => {
                    modalEl.classList.add('hidden');
                    document.body.style.overflow = '';
                 }, 300); // 300ms يتناسب مع transition: all 0.3s
            } else {
                modalEl.classList.add('hidden');
                document.body.style.overflow = '';
            }
        }

        // الحركة السلسة لقائمة الجوال
        function toggleMobileMenu() {
            const mobileMenu = document.getElementById('mobile-menu');
            const openIcon = document.getElementById('menu-icon-open');
            const closeIcon = document.getElementById('menu-icon-close');
            
            mobileMenu.classList.toggle('open');
            openIcon.classList.toggle('hidden');
            closeIcon.classList.toggle('hidden');
        }
        
        // --- Custom Confirmation Modal Logic ---
        
        window.showConfirmationModal = function(message, actionCallback) {
            document.getElementById('confirm-message').textContent = message;
            pendingAction = actionCallback;
            showModal('confirmation-modal');
        }

        function executePendingAction(isConfirmed) {
            hideModal('confirmation-modal');
            if (isConfirmed && typeof pendingAction === 'function') {
                pendingAction();
            }
            pendingAction = null;
        }

        // الدالة التي يتم استدعاؤها من زر الحذف في الإدارة
        window.deleteProductPrompt = function(productId) {
            showConfirmationModal("هل أنت متأكد من حذف هذا المنتج؟ سيتم حذفه من التخزين المحلي.", () => deleteProduct(productId));
        }

        // --- LocalStorage Data Functions ---

        function loadData(key) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : [];
            } catch (e) {
                console.error(`Error loading data from ${key}:`, e);
                return [];
            }
        }

        function saveData(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
            } catch (e) {
                console.error(`Error saving data to ${key}:`, e);
                showMessage("خطأ في حفظ البيانات محليًا. قد تكون سعة التخزين ممتلئة.", true);
            }
        }
        
        // --- Auth Functions (Local Storage) ---

        function isAdminLoggedIn() {
            return localStorage.getItem(ADMIN_STORAGE_KEY) === 'true';
        }

        function updateAuthUI() {
            const isLoggedIn = isAdminLoggedIn();
            const loginLink = document.getElementById('login-nav-link');
            const logoutLink = document.getElementById('logout-nav-link');
            const loginMobile = document.getElementById('login-mobile-link');
            const logoutMobile = document.getElementById('logout-mobile-link');
            
            if (isLoggedIn) {
                loginLink.classList.add('hidden');
                logoutLink.classList.remove('hidden');
                loginMobile.classList.add('hidden');
                logoutMobile.classList.remove('hidden');
                showView('admin'); 
            } else {
                loginLink.classList.remove('hidden');
                logoutLink.classList.add('hidden');
                loginMobile.classList.remove('hidden');
                logoutMobile.classList.add('hidden');
                // إذا لم يكن المدير مسجل الدخول، تأكد من عرض الرئيسية إذا لم يكن في صفحة أخرى
                if (document.getElementById('admin-view').classList.contains('hidden') === false) {
                    showView('home'); 
                }
            }
        }

        function signIn(e) {
            e.preventDefault();
            
            const email = document.getElementById('admin-email').value;
            const password = document.getElementById('admin-password').value;
            
            if (email === ADMIN_EMAIL && password === ADMIN_PASSWORD) {
                localStorage.setItem(ADMIN_STORAGE_KEY, 'true');
                showMessage("تم تسجيل الدخول بنجاح كمدير!", false);
                updateAuthUI();
                showView('admin');
                document.getElementById('login-form').reset();
            } else {
                showMessage("فشل تسجيل الدخول. تحقق من الإيميل وكلمة المرور.", true);
            }
        }

        function signOutUser() {
            localStorage.removeItem(ADMIN_STORAGE_KEY);
            showMessage("تم تسجيل الخروج بنجاح.", false);
            updateAuthUI();
            showView('home');
        }
        
        // --- Image Handling (Base64 Conversion) ---
        
        // تحويل الملف المحلي إلى نص Base64 للحفظ في LocalStorage
        function getBase64Image(file) {
            return new Promise((resolve, reject) => {
                if (!file) {
                    resolve(null);
                    return;
                }
                // التحقق من حجم الملف (1 ميجابايت = 1024 * 1024 بايت)
                if (file.size > 1024 * 1024) { 
                    reject(new Error("حجم الصورة يتجاوز الحد المسموح به (1 ميجابايت)."));
                    return;
                }
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
                reader.readAsDataURL(file);
            });
        }


        // --- Product Management (Admin) ---

        function generateUniqueId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        async function addProduct(e) {
            e.preventDefault();
            if (!isAdminLoggedIn()) return showMessage("الوصول غير مصرح به.", true);
            
            const name = document.getElementById('product-name').value;
            const desc = document.getElementById('product-desc').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const imageFile = document.getElementById('product-image-file').files[0];
            
            let imageDataUrl = 'https://placehold.co/600x400/10B981/ffffff?text=منتج+جديد'; // الصورة الافتراضية

            try {
                if (imageFile) {
                    imageDataUrl = await getBase64Image(imageFile); 
                }
            } catch (error) {
                showMessage(`خطأ في رفع الصورة: ${error.message}`, true);
                return; 
            }

            const newProduct = {
                id: generateUniqueId(),
                name,
                description: desc,
                price,
                imageUrl: imageDataUrl, 
                createdAt: new Date().toISOString()
            };

            const products = loadData(PRODUCTS_STORAGE_KEY);
            products.push(newProduct);
            saveData(PRODUCTS_STORAGE_KEY, products);

            showMessage("تم نشر المنتج بنجاح!", false);
            document.getElementById('product-form').reset();
            renderAllData();
        }

        function deleteProduct(productId) {
            if (!isAdminLoggedIn()) return showMessage("الوصول غير مصرح به.", true);
            
            let products = loadData(PRODUCTS_STORAGE_KEY);
            products = products.filter(p => p.id !== productId);
            saveData(PRODUCTS_STORAGE_KEY, products);
            showMessage("تم حذف المنتج بنجاح.", false);
            renderAllData();
        }
        
        // --- Shopping Cart Functions ---
        
        function loadCart() {
            return loadData(CART_STORAGE_KEY);
        }
        
        function saveCart(cart) {
            saveData(CART_STORAGE_KEY, cart);
            updateCartIconCount();
            renderCart();
        }

        function updateCartIconCount() {
            const cart = loadCart();
            const count = cart.reduce((total, item) => total + item.quantity, 0);
            const countEl = document.getElementById('cart-count');
            
            if (count > 0) {
                countEl.textContent = count;
                countEl.classList.remove('hidden');
            } else {
                countEl.classList.add('hidden');
            }
        }
        
        window.addToCart = function(productId) {
            const products = loadData(PRODUCTS_STORAGE_KEY);
            const product = products.find(p => p.id === productId);
            if (!product) return showMessage("المنتج غير موجود.", true);

            let cart = loadCart();
            const existingItemIndex = cart.findIndex(item => item.id === productId);

            if (existingItemIndex > -1) {
                cart[existingItemIndex].quantity += 1;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    imageUrl: product.imageUrl,
                    quantity: 1
                });
            }
            
            saveCart(cart);
            showMessage(`تمت إضافة ${product.name} إلى السلة!`, false);
        }

        window.updateCartQuantity = function(productId, delta) {
            let cart = loadCart();
            const itemIndex = cart.findIndex(item => item.id === productId);

            if (itemIndex > -1) {
                cart[itemIndex].quantity += delta;
                
                if (cart[itemIndex].quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }
                saveCart(cart);
            }
        }

        window.removeFromCart = function(productId) {
            showConfirmationModal("هل أنت متأكد من إزالة هذا المنتج من السلة؟", () => {
                let cart = loadCart();
                cart = cart.filter(item => item.id !== productId);
                saveCart(cart);
                showMessage("تمت إزالة المنتج من السلة.", false);
            });
        }

        function renderCart() {
            const cart = loadCart();
            const listEl = document.getElementById('cart-items-list');
            const totalEl = document.getElementById('cart-total');
            const emptyMsgEl = document.getElementById('empty-cart-message');
            const checkoutBtn = document.getElementById('checkout-button');
            
            listEl.innerHTML = '';
            let total = 0;

            if (cart.length === 0) {
                emptyMsgEl.classList.remove('hidden');
                totalEl.textContent = '0 ج.م/ر.س';
                checkoutBtn.disabled = true;
                return;
            }
            
            emptyMsgEl.classList.add('hidden');
            checkoutBtn.disabled = false;

            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                total += itemTotal;
                
                const itemHtml = `
                    <div class="flex items-center justify-between p-3 bg-gray-700 rounded-lg shadow-md smooth-transition">
                        <img src="${item.imageUrl}" onerror="this.onerror=null; this.src='https://placehold.co/40x40/10B981/ffffff?text=صورة';" alt="${item.name}" class="w-10 h-10 object-cover rounded-md ml-3">
                        <div class="flex-grow">
                            <p class="font-semibold text-white truncate">${item.name}</p>
                            <p class="text-xs text-gray-400">${item.price} x ${item.quantity}</p>
                        </div>
                        <div class="flex items-center space-x-2 space-x-reverse ml-4">
                            <!-- أزرار التحكم بالكمية -->
                            <button onclick="updateCartQuantity('${item.id}', 1)" class="text-green-400 hover:text-green-300 smooth-transition p-1 rounded-full hover:bg-gray-800">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v3m0 0v3m0-3h3m-3 0H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </button>
                            <span class="text-white font-bold">${item.quantity}</span>
                            <button onclick="updateCartQuantity('${item.id}', -1)" class="text-yellow-400 hover:text-yellow-300 smooth-transition p-1 rounded-full hover:bg-gray-800">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12H9m12 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                            </button>
                            <!-- زر الحذف -->
                            <button onclick="removeFromCart('${item.id}')" class="text-red-400 hover:text-red-500 smooth-transition p-1 rounded-full hover:bg-gray-800">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                            </button>
                        </div>
                    </div>
                `;
                listEl.insertAdjacentHTML('beforeend', itemHtml);
            });
            
            totalEl.textContent = `${total.toFixed(2)} ج.م/ر.س`;
        }

        window.prepareCheckout = function() {
            const cart = loadCart();
            if (cart.length === 0) return showMessage("السلة فارغة. يرجى إضافة منتجات أولاً.", true);
            
            const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0).toFixed(2);
            document.getElementById('checkout-total-display').textContent = `${total} ج.م/ر.س`;
            
            hideModal('cart-modal');
            showModal('checkout-modal');
        }

        // --- Product Rendering ---

        function renderProducts() {
            const products = loadData(PRODUCTS_STORAGE_KEY);
            const listEl = document.getElementById('products-list');
            const publishedListEl = document.getElementById('published-products-list');
            const noProductsEl = document.getElementById('no-products-message');
            
            listEl.innerHTML = '';
            publishedListEl.innerHTML = '';

            if (products.length === 0) {
                noProductsEl.classList.remove('hidden');
                publishedListEl.insertAdjacentHTML('beforeend', '<p class="text-gray-500">لم يتم نشر أي منتجات بعد.</p>');
                return;
            }
            noProductsEl.classList.add('hidden');
            
            products.forEach(product => {
                const imageSource = product.imageUrl;
                // Customer Product Card - تغيير زر الشراء إلى إضافة للسلة
                const productCard = `
                    <div class="bg-gray-800 border border-gray-700 rounded-xl overflow-hidden shadow-2xl smooth-transition hover:shadow-green-500/50 hover:scale-[1.02]">
                        <img src="${imageSource}" onerror="this.onerror=null; this.src='https://placehold.co/600x400/10B981/ffffff?text=خطأ+صورة';" alt="${product.name}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="text-2xl font-bold text-green-400 mb-2">${product.name}</h3>
                            <p class="text-gray-400 text-sm mb-4 line-clamp-3">${product.description}</p>
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-2xl font-black text-yellow-300">${product.price}</span>
                                <span class="text-gray-500">ج.م/ر.س</span>
                            </div>
                            <button onclick="addToCart('${product.id}')" class="w-full bg-yellow-400 text-gray-900 font-bold py-2 rounded-lg hover:bg-yellow-500 smooth-transition shadow-md transform hover:scale-[0.99]">
                                إضافة للسلة
                            </button>
                        </div>
                    </div>
                `;
                listEl.insertAdjacentHTML('beforeend', productCard);

                // Admin Published List Item
                const adminItem = `
                    <div class="bg-gray-700 p-4 rounded-lg flex justify-between items-center smooth-transition hover:bg-gray-600">
                        <div>
                            <p class="font-semibold text-white truncate">${product.name}</p>
                            <p class="text-sm text-yellow-300">السعر: ${product.price}</p>
                        </div>
                        <button onclick="deleteProductPrompt('${product.id}')" class="text-red-400 hover:text-red-500 smooth-transition p-2 rounded-full hover:bg-gray-800">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        </button>
                    </div>
                `;
                publishedListEl.insertAdjacentHTML('beforeend', adminItem);
            });
        }
        
        // --- Orders Management (Local Storage) ---

        function renderOrders() {
            const orders = loadData(ORDERS_STORAGE_KEY).sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            const listEl = document.getElementById('orders-list');
            const noOrdersEl = document.getElementById('no-orders-message');
            listEl.innerHTML = '';
            
            if (orders.length === 0) {
                listEl.appendChild(noOrdersEl);
                noOrdersEl.classList.remove('hidden');
                return;
            }
            noOrdersEl.classList.add('hidden');
            
            orders.forEach(order => {
                const timestamp = new Date(order.timestamp).toLocaleString('ar-EG');
                
                // عرض تفاصيل المنتجات في الطلب
                const productDetails = order.cartItems.map(item => 
                    `<p class="text-xs text-gray-400 mr-2">- ${item.name} (${item.quantity} كمية)</p>`
                ).join('');
                
                const orderItem = `
                    <div class="bg-red-900 bg-opacity-30 p-4 rounded-lg shadow-lg border-r-4 border-red-500 smooth-transition hover:bg-opacity-40">
                        <p class="font-bold text-lg text-white mb-1">طلب شامل جديد</p>
                        <p class="text-sm text-gray-300">العميل: ${order.customerName}</p>
                        <p class="text-sm text-gray-300">الهاتف: ${order.customerPhone}</p>
                        <p class="text-sm text-gray-300 mb-2">العنوان: ${order.customerAddress}</p>
                        
                        <div class="border-t border-red-700 pt-2">
                            <p class="text-sm font-semibold text-yellow-300">المنتجات:</p>
                            ${productDetails}
                            <p class="text-sm font-bold text-green-400 mt-2">الإجمالي: ${order.totalPrice.toFixed(2)} ج.م/ر.س</p>
                        </div>
                        <p class="text-xs text-gray-400 mt-2">وقت الطلب: ${timestamp}</p>
                    </div>
                `;
                listEl.insertAdjacentHTML('beforeend', orderItem);
            });
        }


        // --- Purchase Submission (Customer) ---

        function submitPurchase(e) {
            e.preventDefault();
            
            const cart = loadCart();
            if (cart.length === 0) return showMessage("خطأ: السلة فارغة. يجب أن تبدأ عملية الشراء من السلة.", true);
            
            const customerName = document.getElementById('customer-name').value;
            const customerPhone = document.getElementById('customer-phone').value;
            const customerAddress = document.getElementById('customer-address').value;
            const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            const orders = loadData(ORDERS_STORAGE_KEY);
            const newOrder = {
                id: generateUniqueId(),
                cartItems: cart, // حفظ محتويات السلة بالكامل
                customerName,
                customerPhone,
                customerAddress,
                totalPrice,
                status: 'New',
                timestamp: new Date().toISOString()
            };
            
            orders.push(newOrder);
            saveData(ORDERS_STORAGE_KEY, orders);
            saveCart([]); // تفريغ السلة بعد إتمام الطلب

            showMessage("تم إرسال طلب الشراء بنجاح! سيتم التواصل معكم قريباً.", false);
            hideModal('checkout-modal');
            document.getElementById('purchase-form').reset();
            renderAllData();
            showView('home'); // العودة للصفحة الرئيسية
        }
        
        function renderAllData() {
            renderProducts();
            renderCart(); // تحديث السلة دائماً
            if (isAdminLoggedIn()) {
                renderOrders();
            }
        }
        
        // --- Initialization and Event Listeners ---

        document.addEventListener('DOMContentLoaded', () => {
            // Mobile Menu Toggle
            const menuButton = document.getElementById('mobile-menu-button');
            if (menuButton) menuButton.addEventListener('click', toggleMobileMenu);
            
            // Forms Listeners
            document.getElementById('login-form').addEventListener('submit', signIn);
            document.getElementById('product-form').addEventListener('submit', addProduct);
            document.getElementById('purchase-form').addEventListener('submit', submitPurchase);

            // Initial setup
            updateAuthUI();
            renderAllData(); 
            
            // Make functions globally accessible for inline onclick handlers
            window.showView = showView; 
            window.signOutUser = signOutUser;
            window.toggleMobileMenu = toggleMobileMenu;
            window.hideModal = hideModal;
            window.prepareCheckout = prepareCheckout;
            window.executePendingAction = executePendingAction;
        });

    </script>
</body>
</html>

